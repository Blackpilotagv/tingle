<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{stock_symbol}} - Stock Page</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav>
        <!-- navigation bar logo -->
        
        <div class="nav-left1">
            <img src="{{ url_for('static', filename='images/bot logo.png') }}" alt="Logo" class="nav-logo">
        </div>

        <!-- nav title -->
        <div class="nav-middle">Tingle</div>
         
         <!-- trade set dropdown -->

        <div class="nav-right">
            <div class="dropdown">
                <button class="botton">Trade Set ‚è∑</button>
                <div class="dropdown-content" style="width: 300px; padding: 15px;">

                    <!-- Bot control on and off -->
                    <div class="section">
                        <h3>Bot Status</h3>
                        <p>Current: <span id="bot-status-dropdown">Stopped</span></p>
                        <button class="btn btn-start" onclick="startBot()">Start Bot</button>
                        <button class="btn btn-stop" onclick="stopBot()">Stop Bot</button>
                    </div>
                      
                      <!-- strategy slection --> 

                    <div class="section">
                        <h3>Strategy</h3>
                        <select id="strategy" class="input-box">
                            <option value="candlestick">Candlestick Pattern</option>
                            <option value="moving-average">Moving Average</option>
                            <option value="rsi">RSI Strategy</option>
                        </select>
                    </div>
                       
                       <!-- set stop loss and gain stop setup -->
                       
                    <div class="section">
                        <h3>Risk Management</h3>
                        <label>Capital Allocation (‚Çπ):</label>
                        <input type="number" id="capital" class="input-box" placeholder="e.g., 5000">
                        <label>Stop Loss (%):</label>
                        <input type="number" id="stoploss" class="input-box" placeholder="e.g., 2">
                        <label>Take Profit (%):</label>
                        <input type="number" id="takeprofit" class="input-box" placeholder="e.g., 5">
                    </div>

                    <!-- money management datas -->

                    <div class="section">
                        <h3>Account Summary</h3>
                        <p>üí∞ Balance: <span id="account-balance-dd">‚Çπ0.00</span></p>
                        <p>üìà Margin Used: <span id="margin-used">0%</span></p>
                        <p>üìä Running Trades: <span id="running-trades">0</span></p>
                    </div>
                </div>
            </div>
           <!-- back button -->
            <div class="nav-right1">
                <a href="{{ url_for('index') }}">‚¨Ö Back</a>
            </div>
        </div>
    </nav>

    <!-- Stock chart Content -->
    <div class="main">
        <h1 id="symbol-text">{{stock_symbol}}</h1>
       
    </div>

    <div id="candleContainer"></div>
<button onclick="getPrice()">Get Price</button>
<div id="data">
  
</div>
<p id="indicator"></p>

<script>
async function getPrice() {
    const stock_symbol = document.getElementById("symbol-text").textContent.trim();

    if (!stock_symbol) {
        console.error("No stock symbol found!");
        return;
    }

    const res = await fetch(`/stock/data/${stock_symbol}`);
    const data = await res.json();

    console.log("Fetched data", data);

    if (data.error) {
        document.getElementById("data").innerHTML = `<p>${data.error}</p>`;
        document.getElementById("indicator").innerText = "Trend Indicator";
        return;
    }

    // Update Trend Indicator
    let trendText = "";
    if (data.current >= data.open) {
        trendText = "üìà Uptrend";
        document.getElementById("indicator").style.color = "green";
    } else {
        trendText = "üìâ Downtrend";
        document.getElementById("indicator").style.color = "red";
    }
    document.getElementById("indicator").innerText = trendText;

    // Update Current OHLC Card
    document.getElementById("data").innerHTML = `
      <div class="card">
        <h3>${data.symbol}</h3>
        <p>Current: $${data.current}</p>
        <p>Open: $${data.open}</p>
        <p>High: $${data.high}</p>
        <p>Low: $${data.low}</p>
        <p>Previous Close: $${data.previous_close}</p>
      </div>
    `;

    // Render 14 Candle History
    renderHistory(data.history);
}

function renderHistory(history) {
    const container = document.getElementById("candleContainer");
    container.innerHTML = "";  // clear old

    if (!history || history.length === 0) {
        container.innerHTML = "<p>No candle history yet...</p>";
        return;
    }

    history.forEach((c, i) => {
        const item = document.createElement("div");
        item.classList.add("candle-item");

        item.innerHTML = `
          <h4>Candle ${i + 1}</h4>
          <p>Time: ${c.time}</p>
          <p>Open: ${c.open}</p>
          <p>High: ${c.high}</p>
          <p>Low: ${c.low}</p>
          <p>Close: ${c.close}</p>
        `;

        container.appendChild(item);
    });
}

setInterval(getPrice, 5000);
window.onload = getPrice;
</script>


</body>
</html>